---
title: "Untitled"
output: html_document
date: "2024-04-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```






```{r}
library(pwr)
```


Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.
Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% (σm = 0.20), а разница средних составляет −10% (ϵ = μtest - μreference). Клиницисты сообщают нам, что клинически значимая разница составляет 25% (δ = 0.25).

```{r}
alpha <- 0.05 # Уровень значимости
power <- 0.80 # Мощность
sigma <- 0.20 # Стандартное отклонение
delta <- 0.25 # Клинически значимая разница
epsilon <- 0.10 # Разница средних
dropout_rate <- 0.1

Z_alpha <- qnorm(1 - alpha/2) # Z-значение для alpha/2
Z_beta <- qnorm(power) # Z-значение для заданной мощности

# Расчет размера выборки
n <- ((Z_alpha + Z_beta)^2 * sigma^2) / (2 * (delta - abs(epsilon))^2)

# Учтём drop-out rate
n_do <- n / (1 - dropout_rate)

# Округлим в большую сторону
n_do <- ceiling(n_do)

cat("Размер выборки для исследования:", n_do)
```

Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница δ = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата p2 = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1 = 0.85. Соотношение групп равно k = 1.

```{r}
p1 <- 0.85 # Доля ответов для препарата сравнения
p2 <- 0.65 # Доля ответов для тестового препарата
delta <- -0.1 # Клинически значимая разница

# Расчет размера выборки
n2 <- ((Z_alpha + Z_beta)^2 * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2

# Учтём drop-out rate
n_do2 <- n2 / (1 - dropout_rate)

# Округлим в большую сторону
n_do2 <- ceiling(n_do2)

cat("Размер выборки для гипотезы non-inferiority:", n_do2)
```

Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ().

```{r}
HR <- 2 # hazard ratio
d = 0.8 # процент пациентов
p1 = 0.5 # Доля ответов для препарата сравнения
p2 = p1 # Доля ответов для тестового препарата

# Расчет размера выборки
n3 <- ((Z_alpha + Z_beta)^2) / (log(HR)^2 * p1 * p2 * d)

# Учтём drop-out rate
n_do3 <- n3 / (1 - dropout_rate)

# Округлим в большую сторону
n_do3 <- ceiling(n_do3)

cat("Размер выборки для гипотезы equality:", n_do3)
```


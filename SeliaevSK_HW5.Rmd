---
title: "Untitled"
output: html_document
date: "2024-04-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r}
data <- read.csv('wisconsin_breast_cancer.csv')
```

```{r}
library(tidyverse)
library(lmtest)
library(survival)
library(survminer)
```

```{r}
str(data)
```


----Создайте регрессионную модель, которая бы описывала связь среднего радиуса опухоли и средней площади (а), среднего периметра (б), средней симметричности (в).

```{r}
# (а)
rad_area <- lm(radius_mean ~ area_mean, data = data)
summary(rad_area)
```

```{r}
# (б)
rad_perim <- lm(radius_mean ~ perimeter_mean, data = data)
summary(rad_perim)
```

```{r}
# (в)
rad_sym <- lm(radius_mean ~ symmetry_mean, data = data)
summary(rad_sym)
```



---- Постройте графики, на которых отразите регрессионную прямую, и прокомментируйте свои находки.


```{r}
plot(data$area_mean, data$radius_mean, xlab = "Mean Area", ylab = "Mean Radius", main = "Mean Radius vs Mean Area with Regression Line", pch = 3)
abline(rad_area, col = "red")
```

```{r}
plot(data$perimeter_mean, data$radius_mean, xlab = "Mean Perimeter", ylab = "Mean Radius", main = "Mean Radius vs Mean Perimeter with Regression Line", pch = 3)
abline(rad_perim, col = "blue")
```

```{r}
plot(data$symmetry_mean, data$radius_mean, xlab = "Mean Symmetry", ylab = "Mean Radius", main = "Mean Radius vs Mean Symmetry with Regression Line", pch = 3)
abline(rad_sym, col = "green")
```

ВЫВОДЫ:
а) 
--- p-value для обоих коэффициентов очень маленькое (меньше чем 0.001), что говорит о том, что есть статистически значимая связь между средним радиусом опухоли и средней площадью опухоли.
--- Значение Multiple R-squared составляет примерно 0.9749, что означает, что около 97.49% вариации в среднем радиусе опухоли объясняется моделью, которая использует среднюю площадь опухоли.
--- Существует сильная положительная линейная связь между средним радиусом опухоли и средней площадью опухоли.
--- Регрессионная прямая имеет положительный наклон - с увеличением значения предиктора, средний радиус опухоли также увеличивается. Регрессионная прямая покрывает почти все точки на графике - предиктивность высокая.

б)
--- p-value для обоих коэффициентов очень маленькое (меньше чем 0.001), что говорит о том, что есть статистически значимая связь между средним радиусом опухоли и средним периметром опухоли.
--- Значение Multiple R-squared составляет примерно 0.9957, что означает, что около 99.57% вариации в среднем радиусе опухоли объясняется моделью, которая использует средний периметр опухоли.
--- Существует сильная положительная линейная связь между средним радиусом опухоли и средним периметром опухоли.
--- Регрессионная прямая имеет положительный наклон - с увеличением значения предиктора, средний радиус опухоли также увеличивается. Регрессионная прямая покрывает все точки на графике - предиктивность высокая.

в)
--- p-value меньше 0.05, что говорит о том, что есть статистически значимая связь между средним радиусом опухоли и средней симметрией опухоли.
--- Значение Multiple R-squared составляет примерно 0.02183, что означает, что всего лишь около 2.183% вариации в среднем радиусе опухоли объясняется моделью, которая использует среднюю симметрию опухоли.
--- Хотя коэффициент перед средней симметрией значим, значение коэффициента детерминации невелико, что указывает на то, что средняя симметрия опухоли слабо объясняет вариацию в среднем радиусе опухоли. Таким образом, на основе этой модели мы не можем сделать сильного вывода о связи между радиусом опухоли и симметрией.
--- Прямая горизонтальная, это означает, что по визуальным данным нет линейной зависимости между предиктором и целевой переменной. Опять же, на основе этой модели мы не можем сделать сильного вывода о связи между радиусом опухоли и симметрией.




---- Пусть колонка с диагнозом принимает следующие значения: злокачественная опухоль — 1, а доброкачественная — 0. Постройте модель, которая бы прогнозировала вероятность возникновения злокачественной опухоли от среднего радиуса (а), средней площади (б), средней текстуры (в).

```{r}
# Мы будем строить биномиальную модель, поэтому преобразуем признаки в 1 и 0
data$diagnosis_binom <- ifelse(data$diagnosis == "M", 1, 0)
```


```{r}
# (а)
diag_rad <- glm(diagnosis_binom ~ radius_mean, data = data, family = "binomial")
summary(diag_rad)
```

```{r}
# (б)
diag_area <- glm(diagnosis_binom ~ area_mean, data = data, family = "binomial")
summary(diag_area)
```
```{r}
# (в)
diag_text <- glm(diagnosis_binom ~ texture_mean, data = data, family = "binomial")
summary(diag_text)
```

```{r}
# модель для всех трёх
diag_all_factors <- glm(diagnosis_binom ~ radius_mean + area_mean + texture_mean, data = data, family = "binomial")
summary(diag_all_factors)
```

---- Постройте графики. Создайте модель, которая бы прогнозировала вероятность возникновения злокачественной опухоли от всех трех перечисленных факторов.

```{r}
# модель для всех построили выше

plot(data$radius_mean, data$diagnosis_binom, xlab = "Mean Radius", ylab = "Probability of Malignant Tumor", main = "Probability of Malignant Tumor vs Mean Radius")
lines(data$radius_mean, predict(diag_rad, type = "response"), col = "red")
```

```{r}
plot(data$area_mean, data$diagnosis_binom, xlab = "Mean Area", ylab = "Probability of Malignant Tumor", main = "Probability of Malignant Tumor vs Mean Area")
lines(data$area_mean, predict(diag_area, type = "response"), col = "blue")
```

```{r}
plot(data$texture_mean, data$diagnosis_binom, xlab = "Mean Texture", ylab = "Probability of Malignant Tumor", main = "Probability of Malignant Tumor vs Mean Texture")
lines(data$texture_mean, predict(diag_text, type = "response"), col = "green")
```

ВЫВОДЫ:
а) 
--- Значение z value составляет примерно 11.10, а p-value значительно меньше 0.05, что говорит о статистической значимости коэффициента.
--- Модель хорошо соответствует данным и имеет относительно низкое значение AIC, что свидетельствует о её адекватности.
--- Но при этом линии на графике, построенном на основе модели, расположены далеко друг от друга, это может указывать на то, что модель линейной зависимости недостаточно хорошо описывает данные.В данном случае, несмотря на статистическую значимость коэффициента перед предиктором (радиусом опухоли), модель линейной зависимости может быть недостаточной для описания взаимосвязи между радиусом опухоли и вероятностью злокачественного диагноза. Возможно, взаимосвязь имеет нелинейный характер, или наличие других факторов, не учтенных в модели, влияет на вероятность злокачественного диагноза.

б)
--- Значение z value для area_mean составляет примерно 10.80, а p-value значительно меньше 0.05, что говорит о статистической значимости коэффициента.
--- Модель демонстрирует статистически значимую положительную связь между площадью опухоли и вероятностью злокачественного диагноза. Модель хорошо соответствует данным и имеет относительно низкое значение AIC, что свидетельствует о её адекватности.
--- Но при этом линии на графике, построенном на основе модели, расположены далеко друг от друга, это может указывать на то, что модель линейной зависимости может быть недостаточно гибкой для описания данных. В данном случае, несмотря на статистическую значимость коэффициента перед предиктором (площадью опухоли), модель линейной зависимости может быть недостаточной для объяснения взаимосвязи между площадью опухоли и вероятностью злокачественного диагноза. Возможно, зависимость имеет нелинейный характер, или наличие других факторов, не учтенных в модели, влияет на вероятность злокачественного диагноза.

в)
--- Значение z value для texture_mean составляет примерно 8.975, а p-value значительно меньше 0.05 (или даже значительно меньше 0.001), что говорит о статистической значимости коэффициента.
--- Модель демонстрирует статистически значимую положительную связь между текстурой опухоли и вероятностью злокачественного диагноза. Модель хорошо соответствует данным и имеет относительно низкое значение AIC, что свидетельствует о её адекватности.
--- В данном случае линии на графике, построенном на основе модели, расположены плотно друг к другу, это может указывать на то, что модель достаточно хорошо описывает данные и прогнозирует вероятность злокачественного диагноза на основе текстуры опухоли. В данном случае, близкое расположение линий на графике может указывать на линейную или почти линейную зависимость между текстурой опухоли и вероятностью злокачественного диагноза.

модель для всех факторов)
--- Коэффициент перед texture_mean (средняя текстура) статистически значим (p < 0.001), что указывает на то, что средняя текстура опухоли имеет важное влияние на вероятность злокачественного диагноза.
--- Коэффициенты перед area_mean (средняя площадь) и radius_mean (средний радиус) не являются статистически значимыми (p > 0.05), что может означать, что эти факторы могут быть менее важны для предсказания диагноза.
--- Модель показывает, что средняя текстура опухоли значительно влияет на вероятность злокачественного диагноза, в то время как средняя площадь и средний радиус, вероятно, играют менее важную роль в предсказании диагноза. Так как в данном случае мы анализируем влияние всех трёх факторов, то значения влияния (например, p-value) сильно отличаются от тех, что мы видели раньше (когда анализировали по-отдельности). Так же мы можем видеть разный уровень влияния на графиках. Значения текстуры более линейны и являются лучшим предиктором для злокачественного диагноза.





---- Для выполнения этого задания вам понадобится датасет lung, который встроен в пакет survival. Установите этот пакет и загрузите датасет.
---- Создайте переменную event, в которой отразите наличие или отсутствие (1 или 0) интересующего события — смерти пациента.

```{r}
data(lung)
lung$event <- ifelse(lung$status == 2, 1, 0)
```

---- Постройте кривые выживаемости в зависимости от пола (на одном графике должны получиться две кривые для каждого пола и таблица числа пациентов, подверженных риску (at risk) под ним). Поясните получившееся значение p-value для лог-рангового теста и опишите наблюдаемые результаты.

```{r}
surv_data <- Surv(lung$time, lung$event)
fit <- survfit(surv_data ~ sex, data = lung)

ggsurvplot(fit, data = lung, risk.table = TRUE)
```
```{r}
result <- survdiff(surv_data ~ sex, data = lung)
result
```

ВЫВОДЫ:
--- Для мужчин (sex=1) наблюдается 112 событий (смертей), в то время как ожидаемое количество событий составляет 91.6. Это приводит к значению статистики теста (O-E)^2/E равному 4.55.
--- Для женщин (sex=2) наблюдается 53 события, в то время как ожидаемое количество событий составляет 73.4. Это приводит к значению статистики теста (O-E)^2/E равному 5.68.
--- Значение p-value составляет 0.001, что означает, что существует статистически значимое различие в выживаемости между мужчинами и женщинами.
--- Таким образом, на основе этого теста мы можем заключить, что пол пациентов влияет на их выживаемость, и вероятность смерти различается между мужчинами и женщинами.


---- Постройте график кумулятивной функции рисков (cumulative hazard function) для пола. Проинтерпретируйте график.

```{r}
fit <- survfit(Surv(time, event) ~ sex, data = lung)

ggsurvplot(fit, fun = "cumhaz", conf.int = TRUE, risk.table = TRUE)
```

ВЫВОДЫ:
На графике заметно, что кривая соответсвующая мужскому полу растёт с большей скоростью и значимо отличается на начальном и конечном этапах. Относительно визуальных данных этого графика и кривых выживаемости, можно сделать вывод, что пол пациентов влияет на их выживаемость, и вероятность смерти различается между мужчинами и женщинами. Риск смертности мужской популяции увеличивается стремительнее.


---- С помощью функции coxph() постройте регрессию Кокса и оцените влияние пола на выживаемость. Что вы можете сказать о полученных результатах?

```{r}
cox_regr <- coxph(Surv(time, event) ~ sex, data = lung)

summary(cox_regr)
```
ВЫВОДЫ:
--- Коэффициент coef равен -0.5310, что означает, что женщины имеют меньшую склонность к смерти (более высокую выживаемость) по сравнению с мужчинами.
--- p = 0.00149, что означает, что существует статистически значимая связь между полом и выживаемостью.
--- Таким образом, результаты указывают на то, что пол является статистически значимым предиктором выживаемости, и женщины имеют более высокую выживаемость по сравнению с мужчинами.

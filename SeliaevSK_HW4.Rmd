---
title: "Untitled"
output: html_document
date: "2024-04-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```








```{r}
# подгрузим необходимые библиотеки
library(ggplot2)
library(stats)
library(tidyverse)
library(car)
```


----Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

----Задайте seed для воспроизводимости результатом (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

```{r}
set.seed(8)
sample_size <- 30

mean_before <- 150  # значение среднего артериального давления до приема нового препарата
mean_after <- 124   # и после
```


----Сформулируйте нулевую и альтернативную гипотезы.

H0 - значения среднего артериального давления до приёма препарата и после статистически не отличаются
H1 - значения среднего артериального давления до приёма препарата и после статистически различны

----Определите уровень значимости.

```{r}
alpha <- 0.05
```


----Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

```{r}
set.seed(8)

# так как данные относятся к медицинскому\биологическому контексту, то создадим пул значений относительно средних так, чтобы они соответсвовали нормальному распределению

# Обычно для артериального давления у взрослых стандартное отклонение может составлять примерно 10-15 мм рт. ст. для верхнего (систолического) давления. Возьмём 12 для каждого признака

# задаём стандартное отклонение и пул значений для "до приёма препарата"

sd_pressure_before <- 12
pressure_before <- rnorm(sample_size, mean_before, sd_pressure_before)

# задаём стандартное отклонение и пул значений для "после приёма препарата"

sd_pressure_after <- 12
pressure_after <- rnorm(sample_size, mean_after, sd_pressure_after)

# объединим эти значения в один датасет

pressure_df <- data.frame(Before = pressure_before, After = pressure_after)

head(pressure_df)
```

```{r}
# перед статистической проверкой нормальности распределения, оценим распределение визуально

# Построим гистограмму для признака "Before"
ggplot(pressure_df, aes(x = Before)) +
  geom_histogram(bins = 15, fill = "pink", color = "black") +
  labs(title = "Гистограмма для признака Before", x = "До приёма нового препарата", y = "Частота")

# в целом форма колокола наблюдается, поэтому согласно визуальным данным можно сказать, что распределение нормальное. позже проверим статистическим тестом
```

```{r}
# Построим гистограмму для признака "After"

ggplot(pressure_df, aes(x = After)) +
  geom_histogram(bins = 15, fill = "pink", color = "black") +
  labs(title = "Гистограмма для признака After", x = "После приёма нового препарата", y = "Частота")

# в целом форма колокола наблюдается, поэтому согласно визуальным данным можно сказать, что распределение нормальное. позже проверим статистическим тестом
```

```{r}
# Проведём проверку на нормальность с помощью критерия Шапиро-Уилка (Применяется при количестве наблюдений от 8 до 50. Нам подходит)
# H0 - распределение нормальное
# H1 - распределение отлично от нормального

# для ДО
shapiro.test(pressure_df$Before)

# для ПОСЛЕ
shapiro.test(pressure_df$After)

# Для ДО: p-value = 0.5995 - принимаем нулевую гипотезу
# Для ПОСЛЕ: p-value = 0.4037 - принимаем нулевую гипотезу
```
```{r}
# Я хочу проверить следующую гипотезу:
# H0: средние значения показателей артериального давления до и после приёма препарата равны, то есть нет статистически значимых различий между ними.
# H1: Средние значения показателей артериального давления до и после приёма препарата различаются, то есть есть статистически значимые различия между ними.

# Для проверки этой гипотезы я выберу t-test: анализируемые данные дискретные, необходимо проанализировать 2 группы, распределение признаков в каждой выборке соответствует нормальному распределению.
# значение paired = TRUE, потому что есть два наблюдения, собранные на одних и тех же субъектах до и после вмешательства внешнего признака

t.test(pressure_df$Before, pressure_df$After, paired = TRUE)

# p-value = 2.072e-09. Отвергаем нулевую гипотезу и принимаем альтернативную.
```

----Определите наблюдаемое значение статистики, а также критическое значение статистики

```{r}
# Парный t-тест (Ещё раз проведём его для этого блока, чтобы наблюдаемое и критическое значения были вместе)
t_test_res <- t.test(pressure_df$Before, pressure_df$After, paired = TRUE)

# Наблюдаемое значение статистики t
obs_t_statistic <- t_test_res$statistic
print(paste("Наблюдаемое значение статистики t:", obs_t_statistic))

# Число степеней свободы: 30 - 1 = 29
degrees_of_freedom <- 29

# Уровень значимости я задал раннее - 0.05

# Критическое значение статистики t
critical_t_value <- qt(1 - alpha/2, df = degrees_of_freedom)
print(paste("Критическое значение статистики t:", critical_t_value))



#Наблюдаемое значение статистики равное 8.542 явно превышает критическое значение статистики, которое составляет 2.045 (для двустороннего теста на уровне значимости 0.05). Это означает, что мы можем отвергнуть нулевую гипотезу о равенстве средних значений до и после приёма препарата. Таким образом, есть статистически значимые различия между показателями артериального давления до и после приёма препарата.
```

----Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих – 0.2

----Рассмотрите два случая: для выборки sample_size1 <- 100 и sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

```{r}
set.seed(8)

# для sample_size1 <- 100:
sample_size1 <- 100

prob_smokers <- 0.8
prob_nonsmokers <- 0.2

# создадим вектор с числом "удач" и "неудач" (1 и 0)
smoking_data <- rep(c(1, 0), each = (sample_size1 / 2))

cancer_smoker <- rbinom((sample_size1 / 2), 1, 0.8)
cancer_nonsmoker <- rbinom((sample_size1 / 2), 1, 0.2)

cancer <- c(cancer_smoker, cancer_nonsmoker)

# объединим всё в один датасет
size100 <- data.frame(Smoking = smoking_data, LungCancer = cancer)
```

```{r}
set.seed(8)

# для sample_size1 <- 30:
sample_size2 <- 30

# создадим вектор с числом "удач" и "неудач" (1 и 0)
smoking_data2 <- rep(c(1, 0), each = (sample_size2 / 2))

cancer_smoker2 <- rbinom((sample_size2 / 2), 1, 0.8)
cancer_nonsmoker2 <- rbinom((sample_size2 / 2), 1, 0.2)

cancer2 <- c(cancer_smoker2, cancer_nonsmoker2)

# объединим всё в один датасет
size30 <- data.frame(Smoking = smoking_data2, LungCancer = cancer2)
```

----Сформулируйте нулевую и альтернативную гипотезы. Определите уровень значимости.

```{r}
# alpha = 0.05
# H0: Нет статистически значимой разницы в вероятности заболеть раком легких между курящими и некурящими людьми.
# H1: Существует статистически значимая разница в вероятности заболеть раком легких между курящими и некурящими людьми.
```


----Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

```{r}
# Точный критерий Фишера обладает большей точностью в сравнении с асимптотическими методами (такими как Z-тест или хи-квадрат тест) при малых размерах выборок или при сильных отклонениях от нормальности данных
# Точный критерий Фишера не требует предположений о распределении данных и подходит для различных типов данных, включая счётные данные.
# Точный критерий Фишера не требует равенства размеров выборок, что делает его удобным для сравнения групп с неравными размерами выборок.

# для выборки 100
fisher.test(matrix(c(sum(cancer_smoker), sum(cancer_nonsmoker), 
                     sample_size1/2 - sum(cancer_smoker), sample_size1/2 - sum(cancer_nonsmoker)), ncol = 2))

# для выборки 30
fisher.test(matrix(c(sum(cancer_smoker2), sum(cancer_nonsmoker2), 
                     sample_size2/2 - sum(cancer_smoker2), sample_size2/2 - sum(cancer_nonsmoker2)), ncol = 2))


# Для первого теста: Наблюдаемое значение статистики (odds ratio) = 15.41481
# Для второго теста: Наблюдаемое значение статистики (odds ratio) = 45.18712

# Статистическая значимость: Оба теста показывают очень маленькое p-значение (меньше 0.05), что означает, что у нас есть достаточно доказательств для отвержения нулевой гипотезы о равенстве вероятностей заболевания раком легких между курящими и некурящими группами.
```

----Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией. (исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение)

```{r}
set.seed(8)

sample_size <- 70

# Среднее и стандартное отклонение для группы с применением нового метода лечения
mean_new_method <- 3 # Среднее на шкале боли от 0 до 10
sd_new_method <- 1.5 # Стандартное отклонение на шкале боли от 0 до 10

# Среднее и стандартное отклонение для группы с применением диетотерапии
mean_diet_therapy <- 4.5 # Среднее на шкале боли от 0 до 10
sd_diet_therapy <- 2 # Стандартное отклонение на шкале боли от 0 до 10

# Генерация данных для каждой группы с помощью нормального распределения
data_new_method <- round(rnorm(sample_size, mean_new_method, sd_new_method))
data_diet_therapy <- round(rnorm(sample_size, mean_diet_therapy, sd_diet_therapy))

# соберём в один датасет
pain = data.frame(new_method = data_new_method, diet = data_diet_therapy)
```


----Сформулируйте нулевую и альтернативную гипотезы. Определите уровень значимости.

```{r}
# alpha = 0.05
# H0: нет статистически значимых различий между эффективностью лечения новым методом и диетотерапией.
# H1: есть статистически значимое различие между эффективностью лечения новым методом и диетотерапией.
```


----Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

```{r}
# Проведём тсет на нормальность графически
# Для нового метода лечения:
ggplot(pain, aes(x = new_method)) +
  geom_histogram(binwidth = 1, fill = "pink", color = "black") +
  labs(title = "Гистограмма уровня боли (Новый метод)",
       x = "Уровень боли", y = "Частота")
```

```{r}
#Для диетотерапии
ggplot(pain, aes(x = diet)) +
  geom_histogram(binwidth = 1, fill = "lightgreen", color = "black") +
  labs(title = "Гистограмма уровня боли (Диетотерапия)",
       x = "Уровень боли", y = "Частота")
```

```{r}
# Проведём тест на ормальность с помощью критерия Шапиро-Уилка
# H0 - распределение нормально
# H1 - распределение не нормально

# Тест Шапиро-Уилка для группы с новым методом лечения
shapiro.test(pain$new_method)

# Тест Шапиро-Уилка для группы с диетотерапией
shapiro.test(pain$diet)

# p-value обеих групп ниже 0.05. Отвергаем нулевую гипотезу, принимаем альтернативную
```

```{r}
# Учитывая эти результаты, можно воспользоваться непараметрическим тестом, таким как U-тест Манна-Уитни, который является аналогом двухвыборочного t-теста, но не требует предположения о нормальности распределения данных.
wilcox.test(pain$new_method, pain$diet, alternative = "two.sided")

# Наблюдаемое значение статистики (W) в вашем случае составляет 1559.5, а p-значение равно 0.0001784. Это говорит о том, что тест указывает на статистическую значимость различий между группами. Таким образом, мы можем отвергнуть нулевую гипотезу о том, что средние значения в обеих группах равны, и заключить, что существует статистически значимое различие между группой с новым методом лечения и группой с диетотерапией по уровню болевых симптомов.
```

----Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.
```{r}
set.seed(8)

# Создадим датасет
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
mutate(therapy = factor(therapy, levels = c("0", "A", "B")))

tumor$value <- tumor$value + rnorm(30, 0, 760)

# Построим "ящики с усами"
ggplot(tumor, aes(x = therapy, y = value)) +
  geom_boxplot() +
  labs(title = "Размера опухоли от вида лечения",
       x = "Вид лечения",
       y = "Размер опухоли")
```

```{r}
# Дисперсионный анализ
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)

# Результаты дисперсионного анализа (ANOVA) показывают, что F-значение для фактора "therapy" равно 0.486, а p-значение составляет 0.62. Это означает, что на уровне значимости 0.05 нет статистически значимых различий в размере опухоли между группами, принимая во внимание фактор лечения (placebo, препарат A, препарат B). Таким образом, на основании результатов дисперсионного анализа, мы не можем сделать вывод о наличии статистически значимых различий в эффективности лечения между тремя группами.
```

```{r}
# Проведем попарные сравнения с помощью критерия Тьюки
TukeyHSD(anova_result)

#Результаты попарных сравнений с помощью критерия Тьюки не выявили статистически значимых различий в размере опухоли между группами ни в одной паре. Во всех трех случаях p-значения значительно превышают уровень значимости 0.05, что говорит о том, что различия между группами не являются статистически значимыми. Таким образом, данные результаты подтверждают выводы, сделанные на основе дисперсионного анализа: нет статистически значимых различий в эффективности лечения между тремя группами.
```

